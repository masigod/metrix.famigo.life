<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Panel - K-Beauty System</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tabulator CSS & JS -->
    <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Toastify -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <style>
        * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }

        .sync-indicator {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .tabulator {
            font-size: 13px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
        }

        .tabulator-row {
            min-height: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .location-tab {
            cursor: pointer;
            padding: 12px 24px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .location-tab.active {
            background: #3b82f6;
            color: white;
        }

        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
        }

        .sync-status.active {
            display: flex;
            align-items: center;
            gap: 12px;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Sync Status Indicator -->
    <div id="syncStatus" class="sync-status">
        <div class="sync-indicator w-3 h-3 bg-green-500 rounded-full"></div>
        <span class="text-sm font-medium">Syncing...</span>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
        <div class="px-6 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">
                        <i class="fas fa-chart-line text-blue-600 mr-2"></i>
                        Management Panel
                    </h1>
                    <p class="text-sm text-gray-500 mt-1">Real-time Google Sheets Integration</p>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Sync Info -->
                    <div class="text-right">
                        <p class="text-xs text-gray-500">Last Sync</p>
                        <p id="lastSyncTime" class="text-sm font-medium text-gray-700">-</p>
                    </div>

                    <!-- Sync Controls -->
                    <div class="flex gap-2">
                        <button id="manualSyncBtn" onclick="manualSync()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-sync-alt"></i>
                            <span>Manual Sync</span>
                        </button>
                        <button id="autoSyncToggle" onclick="toggleAutoSync()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition flex items-center gap-2">
                            <i class="fas fa-clock"></i>
                            <span id="autoSyncLabel">Auto Sync: OFF</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="px-6 py-8 max-w-[1920px] mx-auto">

        <!-- Location Tabs -->
        <div class="bg-white rounded-lg p-4 mb-6 flex gap-4">
            <div class="location-tab active" onclick="switchLocation('all')">
                <i class="fas fa-globe mr-2"></i>All Locations
            </div>
            <div class="location-tab" onclick="switchLocation('seoul')">
                <i class="fas fa-map-marker-alt mr-2"></i>서울 관리
            </div>
            <div class="location-tab" onclick="switchLocation('suwon')">
                <i class="fas fa-map-marker-alt mr-2"></i>수원 관리
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 mb-8">
            <!-- Total -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-users text-blue-500"></i>
                    <span class="text-xs text-gray-500">100%</span>
                </div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase mb-1">Total</h3>
                <p class="text-2xl font-bold text-gray-900" id="statTotal">0</p>
            </div>

            <!-- Seoul -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-city text-purple-500"></i>
                    <span class="text-xs text-gray-500" id="statSeoulPercent">0%</span>
                </div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase mb-1">Seoul</h3>
                <p class="text-2xl font-bold text-purple-600" id="statSeoul">0</p>
            </div>

            <!-- Suwon -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-building text-indigo-500"></i>
                    <span class="text-xs text-gray-500" id="statSuwonPercent">0%</span>
                </div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase mb-1">Suwon</h3>
                <p class="text-2xl font-bold text-indigo-600" id="statSuwon">0</p>
            </div>

            <!-- Participated -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-check-circle text-green-500"></i>
                    <span class="text-xs text-gray-500" id="statParticipatedPercent">0%</span>
                </div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase mb-1">Participated</h3>
                <p class="text-2xl font-bold text-green-600" id="statParticipated">0</p>
            </div>

            <!-- Not Participated -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-times-circle text-red-500"></i>
                    <span class="text-xs text-gray-500" id="statNotParticipatedPercent">0%</span>
                </div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase mb-1">Not Participated</h3>
                <p class="text-2xl font-bold text-red-600" id="statNotParticipated">0</p>
            </div>

            <!-- Pending -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-hourglass-half text-yellow-500"></i>
                    <span class="text-xs text-gray-500" id="statPendingPercent">0%</span>
                </div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase mb-1">Pending</h3>
                <p class="text-2xl font-bold text-yellow-600" id="statPending">0</p>
            </div>

            <!-- Today -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-calendar-day text-blue-500"></i>
                    <span class="text-xs text-gray-500">Today</span>
                </div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase mb-1">Today's</h3>
                <p class="text-2xl font-bold text-blue-600" id="statToday">0</p>
            </div>

            <!-- Sync Age -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-clock text-gray-500"></i>
                    <span class="text-xs text-gray-500">Minutes</span>
                </div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase mb-1">Sync Age</h3>
                <p class="text-2xl font-bold text-gray-600" id="statSyncAge">-</p>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Participation by Location -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Participation by Location</h3>
                <canvas id="chartLocation" height="200"></canvas>
            </div>

            <!-- Participation Status -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Participation Status</h3>
                <canvas id="chartStatus" height="200"></canvas>
            </div>

            <!-- Daily Trend -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Daily Reservations</h3>
                <canvas id="chartDaily" height="200"></canvas>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-900">Search & Filter</h2>
                <button onclick="clearFilters()" class="text-sm text-blue-600 hover:text-blue-700">
                    <i class="fas fa-times mr-1"></i>Clear All
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <input type="text" id="searchName" placeholder="Search by name..."
                       class="px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                <input type="text" id="searchPhone" placeholder="Search by phone..."
                       class="px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                <input type="date" id="searchDate"
                       class="px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                <select id="searchStatus" class="px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                    <option value="">All Status</option>
                    <option value="participated">Participated</option>
                    <option value="not_participated">Not Participated</option>
                    <option value="pending">Pending</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
            <div class="mt-4 flex gap-2">
                <button onclick="applyFilters()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-search mr-2"></i>Search
                </button>
                <button onclick="exportData()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                    <i class="fas fa-download mr-2"></i>Export CSV
                </button>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-lg font-semibold text-gray-900">Data Table</h2>
                    <p class="text-sm text-gray-500 mt-1">
                        Showing <span id="visibleCount" class="font-medium">0</span> of
                        <span id="totalCount" class="font-medium">0</span> records
                    </p>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="selectedCount">0</span> selected
                </div>
            </div>
            <div id="dataTable"></div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center hidden z-[2000]">
        <div class="bg-white rounded-lg p-6 flex flex-col items-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
            <p class="text-gray-600">Loading data...</p>
        </div>
    </div>

    <script src="management.js"></script>
</body>
</html>